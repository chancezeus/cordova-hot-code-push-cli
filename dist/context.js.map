{"version":3,"sources":["../src/context.js"],"names":["context","ignoredFilesConfigPath","join","process","cwd","defaultWwwFolder","defaultCliConfig","defaultIgnoreList","Context","argv","defaultConfig","sourceDirectory","getSourceDirectory","manifestFilePath","projectsConfigFilePath","ignoredFiles","getIgnoredFiles","consoleArgs","_","length","projectIgnore","readIgnoredFilesProjectConfig","ignoredList","union","remove","item","indexOf","trim","pathToConfig","_trim","readFileSync","split","e"],"mappings":";;;;;QA+BgBA,O,GAAAA,O;;AA/BhB;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMC,yBAAyB,eAAKC,IAAL,CAAUC,QAAQC,GAAR,EAAV,EAAyB,aAAzB,CAA/B;AACA,IAAMC,mBAAmB,eAAKH,IAAL,CAAUC,QAAQC,GAAR,EAAV,EAAyB,KAAzB,CAAzB;AACA,IAAME,mBAAmB,eAAKJ,IAAL,CAAUC,QAAQC,GAAR,EAAV,EAAyB,kBAAzB,CAAzB;AACA,IAAMG,oBAAoB,CACtB,WADsB,EAEtB,gBAFsB,EAGtB,iBAHsB,EAItB,WAJsB,EAKtB,eALsB,EAMtB,QANsB,EAOtB,YAPsB,EAQtB,UARsB,EAStB,MATsB,EAUtB,cAVsB,CAA1B;;IAaMC,O,GACF,iBAAYC,IAAZ,EAAkB;AAAA;;AACd,SAAKA,IAAL,GAAYA,OAAOA,IAAP,GAAc,EAA1B;AACA,SAAKC,aAAL,GAAqBJ,gBAArB;AACA,SAAKK,eAAL,GAAuBC,mBAAmBH,IAAnB,CAAvB;AACA,SAAKI,gBAAL,GAAwB,eAAKX,IAAL,CAAU,KAAKS,eAAf,EAAgC,eAAhC,CAAxB;AACA,SAAKG,sBAAL,GAA8B,eAAKZ,IAAL,CAAU,KAAKS,eAAf,EAAgC,WAAhC,CAA9B;AACA,SAAKI,YAAL,GAAoBC,iBAApB;AACH,C;;AAGE,SAAShB,OAAT,CAAiBS,IAAjB,EAAuB;AAC1B,WAAO,IAAID,OAAJ,CAAYC,IAAZ,CAAP;AACH;;AAED,SAASG,kBAAT,CAA4BH,IAA5B,EAAkC;AAC9B,QAAMQ,cAAcR,KAAKS,CAAzB;;AAEA,QAAI,CAACD,WAAD,IAAgBA,YAAYE,MAAZ,KAAuB,CAA3C,EAA8C;AAC1C,eAAOd,gBAAP;AACH;;AAED,WAAO,eAAKH,IAAL,CAAUC,QAAQC,GAAR,EAAV,EAAyBa,YAAY,CAAZ,CAAzB,CAAP;AACH;;AAED,SAASD,eAAT,GAA2B;AACvB,QAAMI,gBAAgBC,8BAA8BpB,sBAA9B,CAAtB;AACA,QAAMqB,cAAc,iBAAEC,KAAF,CAAQhB,iBAAR,EAA2Ba,aAA3B,CAApB;;AAEA;AACA,qBAAEI,MAAF,CAASF,WAAT,EAAsB,UAAUG,IAAV,EAAgB;AAClC,eAAOA,KAAKC,OAAL,CAAa,GAAb,MAAsB,CAAtB,IAA2B,iBAAEC,IAAF,CAAOF,IAAP,EAAaN,MAAb,KAAwB,CAA1D;AACH,KAFD;;AAIA,WAAOG,WAAP;AACH;;AAED,SAASD,6BAAT,CAAuCO,YAAvC,EAAqD;AACjD,QAAI;AACA,eAAOC,MAAM,kBAAGC,YAAH,CAAgBF,YAAhB,EAA8B,MAA9B,CAAN,EAA6CG,KAA7C,CAAmD,IAAnD,CAAP;AACH,KAFD,CAEE,OAAOC,CAAP,EAAU,CACX;;AAED,WAAO,EAAP;AACH","file":"context.js","sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport _ from 'lodash';\n\nconst ignoredFilesConfigPath = path.join(process.cwd(), '.chcpignore');\nconst defaultWwwFolder = path.join(process.cwd(), 'www');\nconst defaultCliConfig = path.join(process.cwd(), 'cordova-hcp.json');\nconst defaultIgnoreList = [\n    '.DS_Store',\n    'node_modules/*',\n    'node_modules\\\\*',\n    'chcp.json',\n    'chcp.manifest',\n    '.chcp*',\n    '.gitignore',\n    '.gitkeep',\n    '.git',\n    'package.json'\n];\n\nclass Context {\n    constructor(argv) {\n        this.argv = argv ? argv : {};\n        this.defaultConfig = defaultCliConfig;\n        this.sourceDirectory = getSourceDirectory(argv);\n        this.manifestFilePath = path.join(this.sourceDirectory, 'chcp.manifest');\n        this.projectsConfigFilePath = path.join(this.sourceDirectory, 'chcp.json');\n        this.ignoredFiles = getIgnoredFiles();\n    }\n}\n\nexport function context(argv) {\n    return new Context(argv);\n}\n\nfunction getSourceDirectory(argv) {\n    const consoleArgs = argv._;\n\n    if (!consoleArgs || consoleArgs.length !== 2) {\n        return defaultWwwFolder;\n    }\n\n    return path.join(process.cwd(), consoleArgs[1]);\n}\n\nfunction getIgnoredFiles() {\n    const projectIgnore = readIgnoredFilesProjectConfig(ignoredFilesConfigPath);\n    const ignoredList = _.union(defaultIgnoreList, projectIgnore);\n\n    // remove comments and empty items\n    _.remove(ignoredList, function (item) {\n        return item.indexOf('#') === 0 || _.trim(item).length === 0;\n    });\n\n    return ignoredList;\n}\n\nfunction readIgnoredFilesProjectConfig(pathToConfig) {\n    try {\n        return _trim(fs.readFileSync(pathToConfig, 'utf8')).split(/\\n/);\n    } catch (e) {\n    }\n\n    return [];\n}\n"]}